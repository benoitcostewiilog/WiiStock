{% extends 'layout.html.twig' %}

{% block wrapperClass 'd-flex flex-column' %}
{% block pageContainerClass 'flex-grow-1 p-0' %}

{% set displayTitle = (visibleDashboards|length > 0) %}
{% block title %}{{ displayTitle ? 'Dashboard' }}{% endblock %}

{% block subtitle %}
    <div class="row align-items-center">
        {% if displayTitle and hasRight(constant('App\\Entity\\Menu::ACCUEIL'), constant('App\\Entity\\Action::DISPLAY_INDI')) %}
            <div class="col-auto">
                <div class="dashboard-spinner spinner-border spinner-border-sm text-white" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
            </div>
        {% endif %}
        {% if isCurrentClient(constant('App\\Service\\SpecificService::CLIENT_CEA_LETI')) %}
            <div class="col-auto mx-auto">
                {% include "accueil/linkToAddArticleForm.html.twig" %}
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block page_content %}
    {% if hasRight(constant('App\\Entity\\Menu::ACCUEIL'), constant('App\\Entity\\Action::DISPLAY_INDI')) %}
        <div id="carousel-dashboard" class="carousel slide">
            <ol class="carousel-indicators">
                {% for dashboard in visibleDashboards %}
                    <li data-target="#carousel-dashboard"
                        class="indicator"
                        data-slide-to="{{ loop.index0 }}"
                        data-name="{{ dashboard }}"></li>
                {% endfor %}
            </ol>
            <div class="carousel-inner h-100">
                {% for dashboard in visibleDashboards %}
                    <div class="carousel-item"
                         data-name="{{ dashboard }}">
                        <div class="col-12">
                            {% if dashboard == 'arrivage' %}
                                {% include 'accueil/dashboardArrival.html.twig' %}
                            {% elseif dashboard == 'quai' %}
                                {% include 'accueil/dashboardDockReception.html.twig' with { 'isDashboardExt': 0 } %}
                            {% elseif dashboard == 'admin' %}
                                {% include 'accueil/dashboardAdminReception.html.twig' with { 'isDashboardExt': 0 } %}
                            {% elseif dashboard == 'emballage' %}
                                {% include 'accueil/dashboardMonitoringPackaging.html.twig' with { 'isDashboardExt': 0 } %}
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="row">
                <div class="col-12 little-font text-right fixed-bottom z-index-back d-none refresh-date-container">
                    Actualisation des compteurs le : <span class="metersRefreshDate"></span>
                    - Actualisation des graphes le : <span class="graphsRefreshDate"></span>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/dashboard.js') }}?{{ date().timestamp }}"></script>
{% endblock %}
