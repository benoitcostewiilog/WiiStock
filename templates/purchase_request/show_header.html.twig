{% extends 'utils/show-header.html.twig' %}

{% block showTitle ('Demande d\'achat ' ~ request.number) %}

{% set hasRightDelete = hasRight(constant('App\\Entity\\Menu::DEM'), constant('App\\Entity\\Action::DELETE')) %}
{% set hasRightEdit = hasRight(constant('App\\Entity\\Menu::DEM'), constant('App\\Entity\\Action::EDIT')) %}

{# droit de suppression pour les demandes d'achats brouillons #}
{% if request.status.draft %}
    {% set hasRightDelete = hasRightDelete and hasRight(constant('App\\Entity\\Menu::DEM'), constant('App\\Entity\\Action::DELETE_DRAFT_PURCHASE_REQUEST')) %}
    {% set hasRightEdit = hasRightEdit and hasRight(constant('App\\Entity\\Menu::DEM'), constant('App\\Entity\\Action::EDIT_DRAFT_PURCHASE_REQUEST')) %}
{% elseif request.status.notTreated or request.status.inProgress %} {# droit de suppression pour les demandes d'achats à traiter et en cours #}
    {% set hasRightDelete = hasRightDelete and hasRight(constant('App\\Entity\\Menu::DEM'), constant('App\\Entity\\Action::DELETE_ONGOING_PURCHASE_REQUESTS')) %}
    {% set hasRightEdit = hasRightEdit and hasRight(constant('App\\Entity\\Menu::DEM'), constant('App\\Entity\\Action::EDIT_ONGOING_PURCHASE_REQUESTS')) %}
{% elseif request.status.treated %} {# droit de suppression pour les demandes d'achats traités #}
    {% set hasRightDelete = hasRightDelete and hasRight(constant('App\\Entity\\Menu::DEM'), constant('App\\Entity\\Action::DELETE_TREATED_PURCHASE_REQUESTS')) %}
    {% set hasRightDelete = hasRightDelete and hasRight(constant('App\\Entity\\Menu::DEM'), constant('App\\Entity\\Action::EDIT_TREATED_PURCHASE_REQUESTS')) %}
{% endif %}

{% block showActions %}

<div class="btn-group">
    {% if modifiable and hasRight(constant('App\\Entity\\Menu::DEM'), constant('App\\Entity\\Action::EDIT')) %}
        <button type="button"
                onclick="validatePurchaseRequest()"
                data-id='{{ request.id }}'
                class="btn btn-primary btn-ripple">
            <i class="fa fa-check mr-2"></i>
            Valider
        </button>
    {% endif %}
    {% if hasRightEdit or hasRightDelete %}
    <div class="btn-group">
        <button type="button"
                class="btn btn-primary btn-ripple dropdown-toggle dropdown-toggle-split"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false">
            <span class="fa fa-angle-down"></span>
        </button>
        <div class="dropdown-menu dropdown-follow-gt dropdown-menu-right pointer">
            {% if hasRightEdit %}
                <a  onclick="editRow($(this), Routing.generate('purchase_request_api_edit', true), $('#modalEditPurchaseRequest'), $('#submitEditPurchaseRequest'), true, '#modalEditPurchaseRequest .editor-container-edit', false)"
                    title="Modification"
                    data-id='{{ request.id }}'
                    data-target="#modalEditPurchaseRequest"
                    data-toggle="modal"
                    class="dropdown-item">
                    <i class="fa fa-pen mr-2"></i>Modifier</a>
            {% endif %}
            {% if hasRightDelete %}
                <a href="" onclick="deleteRow($(this), $('#modalDeleteRequest'), $('#submitDeleteRequest'))"
                   data-id='{{ request.id }}' data-target='#modalDeleteRequest' data-toggle='modal'
                   class="dropdown-item">
                    <i class="fa fa-trash mr-2"></i>Supprimer</a>
            {% endif %}

        </div>
    </div>
</div>
    {% endif %}
{% endblock %}

{% block showHiddenInputs %}
    <input type="hidden" id="purchase-request-buyer-id" value="{{ request.buyer ? request.buyer.id }}"/>
{% endblock %}
