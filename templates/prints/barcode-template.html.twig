<html lang="fr">
<head>
    <style>
        .barcode-container {
            overflow: hidden;
            box-sizing: border-box;

            width: {{ width }}mm;
            height: {{ height }}mm;
            padding-top: 2%;
        }

        .barcode {
            max-width: 100%;
            margin: 0;
            padding: 0;
            position: relative;
            text-align: center;
        }

        .barcode .barcode-code {
            height: 20%;
        }

        .barcode .barcode-wrapper {
            box-sizing: border-box;
            height: 79%;
            margin-bottom: 1%;
            padding: 5% 5% 0 5%;
        }

        svg {
            max-width: 100%;
            height: 100%;
        }

        .labels {
            text-align: center;
        }

        html, body {
            margin: 0;
            padding: 0;
        }

        .page-breaker {
            page-break-before: always;
            height: 0;
        }

        .logo {
            height: 20%;
            max-height: 35%;
            margin-left: 2%;
        }

        .custom-icon {
            position: absolute;
            top: 1mm;
            right: 1mm;
            height: 20%;
            width: 20%;
        }

        .custom-text {
            position: absolute;
            top: calc(1mm + 20%);
            right: 1mm;
            font-size: 10px;
        }

        .emergency-icon-qrcode {
            position: absolute;
            top: 35%;
            right: 1mm;
            max-height: 20%;
            max-width: 20%;
        }

        .emergency-text-qrcode {
            position: absolute;
            top: 55%;
            right: 1mm;
            font-size: 10px;
        }

        .emergency-icon-c128 {
            position: absolute;
            top: 1mm;
            right: 25%;
            max-height: 20%;
            max-width: 20%;
        }

        .emergency-text-c128 {
            position: absolute;
            top: calc(1mm + 20%);
            right: 25%;
            font-size: 10px;
        }

        * {
            color: black !important;
            font-family: Arial, sans-serif;
        }
    </style>
    <title>{{ title }}</title>
</head>
<body>
{% for config in barcodeConfigs %}
    {% set labelsLength = config.labels|length %}
    {% set barcodeHeight = (labelsLength == 0
        ? (logo ? "80%" : "100%")
            : (labelsLength < 3
            ? (logo ? "55%" : "75%")
            : (logo ? "45%" : "65%")
            )
        ) %}
    {% set labelsStyle = (labelsLength == 0
        ? "display: none;"
        : (labelsLength < 3
            ? "height: 25%;"
            : "height: 35%;"
            )
        ) %}
    {% if not loop.first %}
        <div class="page-breaker"></div>
    {% endif %}

    <div class="barcode-container">

        {% if logo %}
            <img class="logo" src="{{ app.request.scheme ~'://'~ app.request.httpHost ~ "/uploads/attachements/" ~ logo }}" alt="logo">
        {% endif %}

        {% if arrival is defined and arrival is not null %}
            {% if showCustomIcon and customIcon and arrival.customs %}
                <img class="custom-icon" src="{{ app.request.scheme ~'://'~ app.request.httpHost ~ "/uploads/attachements/" ~ customIcon }}" alt="icone douane">
                <div class="custom-text">{{ customText }}</div>
            {% endif %}

            {% if showEmergencyIcon and emergencyIcon and arrival.isUrgent %}
                <img class="emergency-icon-{{ config.barcode.type }}" src="{{ app.request.scheme ~'://'~ app.request.httpHost ~ "/uploads/attachements/" ~ emergencyIcon }}" alt="icone urgence">
                <div class="emergency-text-{{ config.barcode.type }}">{{ emergencyText }}</div>
            {% endif %}
        {% endif %}

        <div class="barcode" style="height: {{ barcodeHeight }}">
            <div class="barcode-wrapper"
                 style="
                 {% if labelsLength == 0 %}
                     height: 69% !important;
                 {% endif %}
                     ">
                {{ printBarcode({
                    code: config.barcode.code,
                    type: config.barcode.type,
                    format: 'svg',
                    height: config.barcode.height,
                    width: config.barcode.width
                })|raw }}
            </div>

            <div class="barcode-code">
                <svg viewBox="0 0 {{ config.barcode.code|length }} 2"
                     xmlns="http://www.w3.org/2000/svg">
                    <text y="1"
                          x="50%"
                          text-anchor="middle"
                          font-size="1">
                        {{ config.barcode.code }}
                    </text>
                </svg>
            </div>
        </div>

        {# 0.65 = multiplicateur en fonction de la police = largeur d'un caractère a peu près #}
        {% set widthFontScale = 0.65 %}
        {# 1.3 = multiplicateur en fonction de la police = hauteur d'un caractère a peu près #}
        {% set heightFontScale = 1.3 %}

        <div class="labels"
             style="{{ labelsStyle }}">
            <svg viewBox="0 0 {{ config.barcode.longestLabel * widthFontScale }} {{ ((config.labels|length) + 1) * heightFontScale }}"
                 xmlns="http://www.w3.org/2000/svg">
                {% for label in config.labels %}
                    <text y="{{ loop.index * heightFontScale }}"
                          x="50%"
                          text-anchor="middle"
                          font-size="1">
                        {{ label|trim }}
                    </text>
                {% endfor %}
            </svg>
        </div>
    </div>
{% endfor %}
</body>
</html>
