{% extends 'layout.html.twig' %}

{% block title %}Demande de collecte{% endblock %}

{% block page_content %}

<div class="row">
    <div class="col">
        <h1>Demande de collecte n° {{ collecte.numero }}</h1>
    </div>
    <div class="col text-right" id='boutonCollecteSup'>
        {% if modifiable %}
            {% if hasRight(constant('App\\Entity\\Menu::DEM_COLLECTE'), constant('App\\Entity\\Action::DELETE')) %}
                <a href="" onclick="deleteRow($(this), $('#modalDeleteCollecte'), $('#submitDeleteCollecte'))"
                   data-id='{{collecte.id}}' data-target='#modalDeleteCollecte' data-toggle='modal'
                   class="btn btn-danger btn-action ml-auto">
                    Supprimer</a>
            {% endif %}
            {% if hasRight(constant('App\\Entity\\Menu::DEM_COLLECTE'), constant('App\\Entity\\Action::CREATE_EDIT')) %}
                <a href="#" data-id='{{collecte.id}}' data-target='#modalEditCollecte' data-toggle='modal'
                   onclick="editRow($(this), Routing.generate('collecte_api_edit', true), $('#modalEditCollecte'), $('#submitEditCollecte'), true) "
                   class="btn btn-primary btn-action ml-auto">
                    Modifier</a>
            {% endif %}
            {% if hasRight(constant('App\\Entity\\Menu::COLLECTE'), constant('App\\Entity\\Action::CREATE_EDIT')) %}
                <a href="#" onclick="validateCollecte({{ collecte.id }})" class="btn btn-primary btn-action ml-auto">Valider</a>
            {% endif %}
        {% endif %}
    </div>
</div>

<div class="row">
    <div class="zone-entete col-6 row">
        {% include "collecte/enteteCollecte.html.twig" %}
    </div>
</div>
{% if modifiable %}
<div class="col text-right"  id='boutonCollecteInf'>
    <a href="{{ path('reference_article_index') }}" data-toggle="modal" class="btn btn-primary btn-action ml-auto">
        Chercher une référence</a>
    {% if hasRight(constant('App\\Entity\\Menu::DEM_COLLECTE'), constant('App\\Entity\\Action::CREATE_EDIT')) %}
    <a href="" data-toggle="modal" data-target="#modalNewArticle"
        onclick="clearDiv(), ajaxAutoRefArticleInit($('#reference'))"
        class="btn btn-primary btn-action ml-auto">
        <span class="fa fa-plus mr-2"></span>Ajouter article
    </a>
    {% endif %}

</div>   
{% endif %}


<table id="tableArticle_id" class="table table-striped table-bordered w-100" data-collecte-id="{{ collecte.id }}">
    <thead>
        <tr>
            <th>Référence CEA</th>
            <th>Libellé</th>
            <th>Emplacement</th>
            <th>Quantité</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>

    </tbody>
</table>

<a href="{{ path('collecte_index') }}" class='btn btn-action'>Retour à la liste</a>
<button class="btn" id="cannotValidate" data-target='#modalCannotValidate' data-toggle='modal' hidden></button>

{% include "collecte/modalNewArticle.html.twig" %}
{% include "collecte/modalDeleteArticle.html.twig" %}
{% include "collecte/modalEditArticle.html.twig" %}
{% include "collecte/modalDeleteCollecte.html.twig" %}
{% include "collecte/modalEditCollecte.html.twig" %}
{% include 'collecte/modalCannotValidate.html.twig' %}
{% include 'reference_article/modalShowRefArticle.html.twig' %}
{% include 'article/modalShowArticle.html.twig' %}

{% endblock %}

{% block javascript %}
<script>
    let id = {{ collecte.id }};
</script>
<script src="{{asset('js/collecte.js')}}?{{ date().timestamp }}"></script>

{% endblock %}