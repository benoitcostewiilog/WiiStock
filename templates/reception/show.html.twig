{% extends "layout.html.twig" %}
{% block title %}{{ 'réception.réception'|trans }}{% endblock %}
{% block page_content %}
    {% set displayLitiges = hasRight(constant('App\\Entity\\Menu::QUALI'), constant('App\\Entity\\Action::DISPLAY_LITI')) %}
    <div class="p-5">
        <div class="row">
            <div class="zone-entete datatable-container shadow-lg">
                {% include "reception/enteteReception.html.twig" %}
            </div>
        </div>
        <div class="row mt-3 justify-content-around">
            <div class="{{ displayLitiges ? 'col-6' : 'col-12' }} pr-2 pl-0">
                <div class="datatable-container shadow-lg">
                    <div class="d-flex row justify-content-end datatable-header">
                        <div class="btn-group col-auto">
                            {% if modifiable %}
                                {% if hasRight(constant('App\\Entity\\Menu::ORDRE'), constant('App\\Entity\\Action::EDIT')) %}
                                    <button type="button" data-toggle="modal" data-target="#modalAddLigneArticle"
                                            class="btn btn-primary btn-ripple ml-auto split-button"
                                            onclick="initNewArticleEditor('#modalAddLigneArticle'),
                                            ajaxAutoFournisseurInit($('.ajax-autocomplete-fournisseur'))">
                                        <span class="fa fa-plus mr-2"></span>Ajouter <span title="article">{{ 'réception.article'|trans }}</span>
                                    </button>
                                {% endif %}
                            {% endif %}
                            <button type="button" class="btn btn-primary split-button-dropdown btn-ripple d-none print" data-toggle="dropdown"
                                    aria-haspopup="true"
                                    aria-expanded="false">
                                <span class="fa fa-angle-down"></span>
                            </button>
                            <div class="dropdown-menu mr-5 pointer">
                                <a href="{{ path('reception_bar_codes_print', {reception: reception.id}) }}"
                                   id="buttonPrintMultipleBarcodes"
                                   class="dropdown-item d-none print">
                                    <span class="fa fa-print mr-2"></span>Générer les étiquettes
                                </a>
                            </div>
                        </div>
                    </div>
                    <table id="tableArticle_id" class="table"></table>
                </div>
            </div>
            {% if displayLitiges %}
                <div class="col-6 pl-2 pr-0">
                    <div class="datatable-container shadow-lg">
                        <div class="d-flex row justify-content-end datatable-header">
                            <div class="col-auto">
                                {% if hasRight(constant('App\\Entity\\Menu::QUALI'), constant('App\\Entity\\Action::CREATE')) %}
                                <button type="button"
                                        data-id='{{ reception.id }}'
                                        data-target='#modalNewLitige'
                                        data-toggle='modal'
                                        class="btn btn-primary btn-ripple ml-auto"
                                        onclick="openNewLitigeModal($(this))">
                                    <i class="fa fa-plus mr-2"></i>
                                    Nouveau litige
                                </button>
                            </div>
                            {% endif %}
                        </div>
                        <div class="mt-3">
                            <table id="tableReceptionLitiges" class="table w-100"></table>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    <button class="btn" id="cannotGenerateStock" data-target='#modalCannotGenerateStock' data-toggle='modal'
            hidden></button>
    <button class="btn" id="chooseConditionnement" data-target='#modalChoose' data-toggle='modal' hidden></button>
    <button class="btn" id="finishReception" data-target='#modalFinishReception' data-toggle='modal' hidden></button>
    <input type="number" id="ligneSelected" value="-1" hidden></button>

    <div class="d-none" id="barcodes">
    </div>


    {% include "reception/modalDeleteReception.html.twig" %}
    {% include "reception/modalEditReception.html.twig" %}
    {% include "reception/modalEditLigneArticle.html.twig" %}
    {% include "reception/modalDeleteLigneArticle.html.twig" %}
    {% include "reception/modalAddLigneArticle.html.twig" %}
    {% include "reception/modalNoStock.html.twig" %}
    {% include "reception/modalChooseConditionnement.html.twig" %}
    {% include "article/modalEditArticle.html.twig" %}
    {% include "article/modalDeleteArticle.html.twig" %}
    {% include 'reception/modalNewLitige.html.twig' %}
    {% include 'reception/modalEditLitige.html.twig' %}
    {% include 'reception/modalNewLigneReception.html.twig' with {createDL: createDL} %}
    {% include 'reception/modalDeleteLitige.html.twig' %}
    {% include 'reception/modalFinishReception.html.twig' %}

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script src="{{ asset('js/form-reference-article.js') }}?{{ date().timestamp }}"></script>
    <script src="{{ asset('js/attachments.js') }}?{{ date().timestamp }}"></script>
    <script src="{{ asset('js/reception-show.js') }}?{{ date().timestamp }}"></script>
    <script src="{{ asset('js/form-litiges.js') }}?{{ date().timestamp }}"></script>
{% endblock %}
