{% extends 'layout.html.twig' %}

{% block title %}Réceptions{% endblock %}

{% block page_content %}

<h1>
    Réceptions
</h1>
<div class='row btn'>
    <a href="" data-toggle="modal" data-target="#dataModalCenter" class="button btn-left">
        <span class="fa fa-plus"></span>Nouvelle reception
    </a>
</div>


<div>
    <table id="table_id" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>Statut</th>
                <th>Date prévue</th>
                <th>Date attendu</th>
                <th>Fournisseur</th>
                <th>Référence</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<!-- <a href="" class="btn btn-xs btn-default command-edit"><i class="fas fa-eye fa-2x"></i></a>
    <a href="" class="btn btn-xs btn-default command-edit"><i class="fas fa-pencil-alt fa-2x"></i></a>
    <a href="" class="btn btn-xs btn-default command-edit"><i class="fas fa-plus fa-2x"></i> Articles</a> -->


{% include "receptions/modal.html.twig" %}

{% endblock %}

{% block javascript %}


<script>

    var table = $('#table_id').DataTable({
        "language": {
            "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/French.json"
        },
        "ajax":{ 
            "url":"{{path('reception_api')}}",
            "type": "POST"
        },

        columns: [
            { "data": 'Statut' },
            { "data": 'Date commande' },
            { "data": 'Date attendu' },
            { "data": 'Fournisseur' },
            { "data": 'Référence' },
            { "data": 'Actions' }
        ],
    });
    // In your Javascript (external .js resource or <script> tag)
    $(document).ready(function () {
        $('.select2').select2();
        let dataModal = document.getElementById("dataModalCenter");
        var ButtonSubmit = document.getElementById("submitButton");

        console.log(ButtonSubmit);

        ButtonSubmit.addEventListener("click", function (event) {
            xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    let obj = JSON.parse(this.responseText);
                    let url = obj.reception.Id;
                    document.getElementById("tbody-data");
                }
            };

            let inputs = document.querySelectorAll(".data"); // On récupère tout les inputs qui nous intéresse avec le querySelectorAll
            let Data = []; // Tableau de données

            inputs.forEach(input => { // Pour chaque input on fait un tableau avec pour clé son nom et comme valeur la valeur dans l'input
                Data.push({ [input.name]: input.value });
                console.log(input);
            })

            Json = JSON.stringify(Data); // On transforme les données en JSON
            xhttp.open("POST", "{{ path('createReception') }}", true);
            xhttp.send(Json);
        });
    });

</script>
{% endblock %}