{% extends "layout.html.twig" %}
{% block title %}Ajout d'articles{% endblock %}
{% block page_content %}

<h1>RECEPTION n°{{reception.numeroReception}}</h1>
<table class="table">
    <tbody>
        <tr>
            <th>Statut</th>
            <td>{{ reception.statut.nom }}</td>
        </tr>
        <tr>
            <th>Commentaire</th>
            <td>{{ reception.commentaire }}</td>
        </tr>
        <tr>
            <th>Date</th>
            <td>{{ reception.date ? reception.date | date('Y-m-d H:i:s') : '' }}</td>
        </tr>
        <tr>
            <th>NumeroArrivage</th>
            <td>{{ reception.numeroArrivage }}</td>
        </tr>
    </tbody>
</table>

<table id="result" class="table table-striped">
    <thead>
        <tr>
            <th>Id</th>
            <th>Nom</th>
            <th>Statut</th>
            <th>Quantite</th>
            <th>Etat</th>
            <th>actions</th>
        </tr>
    </thead>
    <tbody>
        {% for article in reception.articles %}
        <tr>
            <td>{{ article.id }}</td>
            <td>{{ article.nom }}</td>
            <td>{{ article.statut.nom }}</td>
            <td>{{ article.quantite }}</td>
            <td>{{ article.etat ? 'conforme' : 'non-conforme' }}</td>
            <td>
                <a href="{{ path('articles_edit', {'id': article.id}) }}" class="btn btn-xs btn-default command-edit"><i
                        class="fas fa-pencil-alt fa-2x"></i></a>
            </td>
        </tr>
        {% else %}
        <tr id='noResult'>
            <td colspan="7">no records found</td>
        </tr>
        {% endfor %}
    </tbody>
</table>




<a href="" data-toggle="modal" data-target="#dataModalCenter" class="col-2 btn button btn-right">Créer</a>

<a class="btn offset-5 col-2 button btn-right" href={{ path('reception_ajout_article', {'id': id, 'k': true}) }}>fin
    reception</a>

{% endblock %}

{% block javascript %}
<script>
    // In your Javascript (external .js resource or <script> tag)

    let dataModal = document.getElementById("dataModalCenter");
    var ButtonSubmit = document.getElementById("submitButton");

    console.log(ButtonSubmit);

    ButtonSubmit.addEventListener("click", function (event) {
    xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        let obj = JSON.parse(JSON.parse(this.responseText));
        let url = obj.reception.Id;
        document.getElementById("tbody-data");
    }
    };

    let inputs = document.querySelectorAll(".data"); // On récupère tout les inputs qui nous intéresse avec le querySelectorAll
    let Data = []; // Tableau de données

    inputs.forEach(input => { // Pour chaque input on fait un tableau avec pour clé son nom et comme valeur la valeur dans l'input
    Data.push({ [input.name] : input.value });
    console.log(input);
    })

    Json = JSON.stringify(Data); // On transforme les données en JSON
    xhttp.open("POST", "{{ path('createReception') }}", true);
    xhttp.send(Json);
    });
</script>
{% endblock %}