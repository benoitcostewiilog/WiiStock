{% extends 'layout.html.twig' %}

{% block title %}Preparation{% endblock %}

{% block page_content %}
    <h1>Préparation</h1>

    <table class="table">
        <tbody>
            <tr>
                <th class="backtablejv">Id</th>
                <td>{{ preparation.id }}</td>
            </tr>
            <tr>
                <th>Date</th>
                <td class="backtablejv">{{ preparation.date ? preparation.date|date('Y-m-d H:i:s') : '' }}</td>
            </tr>
            <tr>
                <th class="backtablejv">Statut</th>
                <td>{{ preparation.statut.nom }}</td>
            </tr>
            <tr>
                <th> Numero</th>
                <td class="backtablejv">{{preparation.numero}}</td>
            </tr>
        </tbody>
    </table>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Nom</th>
                <th>Statut</th>
                <th>Reférences Articles</th>
                <th>position</th>
                <th>direction</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for demande in preparation.demandes %}
            {% for article in demande.articles |reverse %}
                <tr>
                    <td>{{ article.nom }}</td>
                    <td>{{ article.statut.nom }}</td>
                    <td>{{ article.refArticle.reference }}</td>
                    <td>{{ article.position }}</td>
                    <td>{{ article.direction }}</td>
                    <td>
                        <form action="{{ path('preparation_show', {'id': preparation.id}) }}"  method="post">
                            {% if article.statut.id == 13 and demande.statut.id == 30 %}
                                <button type="submit" name="fin[{{demande.id}}]" value={{article.id}} class="btn btn-xs btn-default command-edit backgreen"><i class="fas fa-check fa-2x"></i></button> 
                            {% endif %}
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="10">aucun résultat</td>
                </tr>
            {% endfor %}
                 
            {% endfor %}
            </tbody>
    </table>

    <a href="{{ path('preparation_index', {'history': 'false'}) }}" class="btn pull-left button btn-right">Retour</a>

    <!-- <a href="{{ path('preparation_edit', {'id': preparation.id}) }}">modifier</a> -->

    {{ include('preparation/_delete_form.html.twig') }}

{% endblock %}
